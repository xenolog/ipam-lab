---
all: # keys must be unique, i.e. only one 'hosts' per group
    hosts:
        # node1:
            # ansible_host: 95.54.0.12
            # ip: 10.3.0.1
            # etcd_member_name: etcd1
        ${cp.name}:
            ip: ${cp.network.1.fixed_ip_v4}
            public_ip: ${cp.network.0.fixed_ip_v4}
            etcd_member_name: etcd1
            ansible_port: 22
%{ for num, minion in minions ~}
        ${minion.name}:
            ansible_port: 220${num}
            ip: ${minion.network.1.fixed_ip_v4}
            public_ip: ${minion.network.0.fixed_ip_v4}
%{ endfor ~}
    vars:
        ansible_ssh_private_key_file: ${ssh_key_file}
        ansible_ssh_user: ubuntu
        ansible_host: ${floating_ip}  # all nodes share one floating IP, but use different ports
        ansible_ssh_common_args: "-o UserKnownHostsFile=/dev/null -o IdentitiesOnly=yes"
        ansible_become: true
        ansible_become_user: root
        cluster_name: ${env_name}.local
        access_ip: ${floating_ip}
        cloud_provider: openstack
        kube_network_plugin: calico
        upstream_dns_servers:
            - 8.8.8.8
            - 8.8.4.4
            - /mirantis.net/172.18.32.6
        nameservers:
            - 8.8.8.8
            - 8.8.4.4
        authorization_modes: AlwaysAllow
        download_run_once: false
        deploy_netchecker: false
        # Required for hyperkube >=1.3.4. Set to false if installing old hyperkube
        overwrite_hyperkube_cni: true
        enable_network_policy: true
        kube_apiserver_insecure_port: "8080"
    children:
        etcd:
            hosts:
                ${cp.name}: {}
        calico-rr:
            hosts:
                ${cp.name}: {}
        kube-master:
            hosts:
                ${cp.name}: {}
            # vars:
            #     g2_var2: value3
        kube-node:
            hosts:
%{ for num, minion in minions ~}
                ${minion.name}: {}
%{ endfor ~}
        k8s-cluster:
            children:
                kube-master: {}
                kube-node: {}
                calico-rr: {}
###